<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LCE Project Hub | Lloyds Consulting & Engineering</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="landing-body">

  <!-- Header -->
  <header class="landing-header">
    <div class="header-content">
      <a href="index.html" class="logo">
        <img src="LCE LOGO.png" alt="LCE Lloyds">
      </a>
      <nav class="header-nav">
        <a href="login.html" class="nav-link">Login</a>
        <a href="signup.html" class="btn btn-green">Create Account</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-inner">
      <div class="hero-text">
        <div class="dept-badge">Civil &amp; Structural Department</div>
        <h1 class="hero-title">
          Project<br>Management<br>
          <span class="accent-text">Hub</span>
        </h1>
        <p class="hero-subtitle">
          A centralised platform for the LCE Civil &amp; Structural team to plan projects,
          assign tasks, and track progress â€” from HOD to Drafting.
        </p>
        <div class="hero-actions">
          <a href="login.html" class="btn-hero-primary">Login to Dashboard</a>
          <a href="signup.html" class="btn-hero-secondary">Create Account</a>
        </div>
      </div>

      <!-- Live Projects Panel -->
      <div class="hero-visual">
        <div class="live-panel">
          <div class="live-panel-title">
            <div class="live-dot"></div>
            Live Projects
          </div>
          <div id="liveProjectsContainer">
            <div class="live-empty">No projects yet.<br>Login to create your first project.</div>
          </div>
          <div id="liveStats" style="margin-top:12px;padding-top:10px;border-top:1px solid rgba(255,255,255,0.1);display:none;">
            <div style="display:flex;justify-content:space-between;font-size:11px;color:rgba(255,255,255,0.5);">
              <span id="lsTotalProjects">0 projects</span>
              <span id="lsTotalTasks">0 tasks</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="features">
    <div class="features-inner">
      <h2>Everything your team needs</h2>
      <p class="features-sub">Built for the Civil &amp; Structural workflow â€” from HOD to Drafting team</p>
      <div class="features-grid">
        <div class="feature-card">
          <span class="feature-icon">ğŸ“</span>
          <h3>Project Management</h3>
          <p>HODs create and manage projects with priority, due dates, and assignees. Full lifecycle control.</p>
        </div>
        <div class="feature-card">
          <span class="feature-icon">âœ…</span>
          <h3>Task Delegation</h3>
          <p>Managers break projects into tasks and assign them down the hierarchy â€” Deputy Managers, Designers, Drafting.</p>
        </div>
        <div class="feature-card">
          <span class="feature-icon">ğŸ“Š</span>
          <h3>Personal Kanban</h3>
          <p>Every team member gets a personal Kanban board showing their tasks in To Do, In Progress, and Done columns.</p>
        </div>
        <div class="feature-card">
          <span class="feature-icon">ğŸ”</span>
          <h3>Role-Based Access</h3>
          <p>Access is automatically determined by your designation â€” from Deputy General Manager to Junior Engineers.</p>
        </div>
        <div class="feature-card">
          <span class="feature-icon">ğŸ¯</span>
          <h3>Priority Tracking</h3>
          <p>Flag projects and tasks as High, Medium, or Low priority. Never lose sight of what matters most.</p>
        </div>
        <div class="feature-card">
          <span class="feature-icon">ğŸ“…</span>
          <h3>Overdue Alerts</h3>
          <p>Overdue projects and tasks are visually highlighted so nothing slips through the cracks.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- How it works -->
  <section class="how-section">
    <div class="how-inner">
      <h2>How it works</h2>
      <p class="how-sub">Simple, role-driven workflow for the entire department</p>
      <div class="how-grid">
        <div class="how-step">
          <div class="how-num purple">1</div>
          <h4>Create Account</h4>
          <p>Sign up with your employee ID, company email, and designation.</p>
        </div>
        <div class="how-step">
          <div class="how-num green">2</div>
          <h4>HOD Creates Projects</h4>
          <p>HODs and Advisors create projects with priority, due date, and team assignments.</p>
        </div>
        <div class="how-step">
          <div class="how-num purple">3</div>
          <h4>Managers Assign Tasks</h4>
          <p>Managers open projects and create tasks for Deputy Managers, Designers, and Drafting teams.</p>
        </div>
        <div class="how-step">
          <div class="how-num green">4</div>
          <h4>Track on Kanban</h4>
          <p>Everyone tracks their work on their personal Kanban board and updates task status.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="landing-footer">
    <p>Â© 2026 Lloyds Consulting &amp; Engineering, Pune &nbsp;Â·&nbsp; Civil &amp; Structural Department</p>
    <p style="margin-top:6px;">Department email: <a href="mailto:lcecst@lloyds.in">lcecst@lloyds.in</a></p>
  </footer>

  <script src="app.js"></script>
  <script>
    // Seed admin on first load
    APP.seedAdmin();

    // If already logged in, go to dashboard
    if (APP.getCurrentUser()) {
      window.location.href = 'dashboard.html';
    }

    // â”€â”€ Real-time live projects from localStorage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadLiveProjects() {
      const projects = APP.getProjects();
      const tasks    = APP.getTasks();
      const container = document.getElementById('liveProjectsContainer');
      const statsEl   = document.getElementById('liveStats');

      if (projects.length === 0) {
        container.innerHTML = '<div class="live-empty">No projects yet.<br>Login to create your first project.</div>';
        return;
      }

      // Show stats
      statsEl.style.display = 'block';
      document.getElementById('lsTotalProjects').textContent = projects.length + ' project' + (projects.length !== 1 ? 's' : '');
      document.getElementById('lsTotalTasks').textContent    = tasks.length + ' task' + (tasks.length !== 1 ? 's' : '');

      // Show up to 4 most recent active projects
      const recent = projects
        .filter(p => p.status !== 'Completed')
        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .slice(0, 4);

      if (recent.length === 0) {
        // All completed â€” show latest 4
        const all = [...projects].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).slice(0, 4);
        container.innerHTML = renderLiveCards(all, tasks);
      } else {
        container.innerHTML = renderLiveCards(recent, tasks);
      }
    }

    function renderLiveCards(projects, allTasks) {
      return projects.map(p => {
        const ptasks = allTasks.filter(t => t.projectId === p.id);
        const done   = ptasks.filter(t => t.status === 'Done').length;
        const pct    = ptasks.length ? Math.round((done / ptasks.length) * 100) : 0;
        const fillColor = pct === 100 ? '#A5D6A7' : (p.priority === 'High' ? '#EF9A9A' : p.priority === 'Medium' ? '#FFE082' : '#A5D6A7');
        const overdue = p.dueDate && new Date(p.dueDate) < new Date() && p.status !== 'Completed';
        return `
          <div class="live-card prio-${p.priority}">
            <div class="lc-name">${escapeHtml(p.title)}</div>
            <div class="lc-bar"><div class="lc-fill" style="width:${pct}%;background:${fillColor};"></div></div>
            <div class="lc-meta">
              ${pct}% done &nbsp;Â·&nbsp; ${ptasks.length} task${ptasks.length !== 1 ? 's' : ''}
              ${overdue ? ' &nbsp;Â·&nbsp; <span style="color:#EF9A9A;">Overdue</span>' : ''}
              ${p.dueDate ? ' &nbsp;Â·&nbsp; Due ' + formatShortDate(p.dueDate) : ''}
            </div>
          </div>`;
      }).join('');
    }

    function formatShortDate(d) {
      return new Date(d).toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });
    }

    function escapeHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }

    // Load on page open
    loadLiveProjects();

    // Poll every 5 seconds for live updates (in case another tab adds a project)
    setInterval(loadLiveProjects, 5000);
  </script>
</body>
</html>
